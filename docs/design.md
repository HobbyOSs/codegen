# `codegen` プロジェクト構成ドキュメント

## **1. `codegen` の概要と目的**

`codegen` は `gosk` への統合前に OCODE の変換およびテストを行うためのサブプロジェクトである。

OCODEとは、簡単なテキスト形式の中間言語
- Statement ごとに 逆ポーランド記法（RPN）で表現される
- 例) `ADD EAX, 1` の場合下記のようなテキスト

```
NN 1
NN EAX
ADD
```
- `NN k` は コードジェネレータの内部スタック にオペランドを積む
- `ADD` はスタックのトップ2つを取り、加算結果をプッシュする
- テキストを「再生（評価）」することで、機械語出力することを狙いとする

本プロジェクトの目的は以下のとおり：
- **OCODE → x86 機械語** への変換を最小構成で実装する。
- 変換プロセスが適切に機能することをテスト可能な形にする。
- `gosk` にライブラリとして統合し、他のプロジェクトでも利用できる設計を目指す。

`gosk` は **ホビー用の x86 アセンブラ** であり、`codegen` はその一部として開発される。

---

## **2. プロジェクトのディレクトリ構成**
```
.
├── main.go             // CLIエントリポイント
├── ocode/
│   ├── ocode.go        // OCODEのデータ構造と定義
│   ├── generator.go    // AST → OCODE 変換(WIP)
├── codegen/
│   ├── x86gen.go       // OCODE → x86 機械語変換
├── docs/
│   ├── design.md       // 設計方針
│   ├── for-aider.md    // 修正依頼用テンプレート
├── go.mod               // Go モジュール管理
```

---

## **3. 各ディレクトリとファイルの役割**

### **メインプログラム (`main.go`)**
- CLIツールとしてテキストファイルを受け付け、変換結果を出力。

### **`ocode/` (OCODE 変換関連)**
- `ocode.go` : OCODE のデータ構造と命令セットの定義。
- `generator.go` : AST から OCODE への変換。

### **`codegen/` (機械語変換関連)**
- `x86gen.go` : OCODE を x86機械語に変換。

### **`docs/` (ドキュメント関連)**
- `design.md` : 設計方針。
- `for-aider.md` : 修正依頼用テンプレート。

---

## **4. まとめ**
- `codegen` は `gosk` のサブプロジェクトとして OCODE の変換を担う。
- 最小構成で変換プロセスを実装し、テスト可能な形にすることが目的。
- `gosk` への統合を見据えたライブラリ設計を意識している。


